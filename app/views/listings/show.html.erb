<% provide(:title, "#{@listing.listing_name}" ) %>

<script>
    function initialize() {
        var location = {lat: Number("<%= @listing.latitude %>"), lng: Number("<%= @listing.longitude %>")};
        var map = new google.maps.Map(document.getElementById('map'),{
            center: location,
            zoom: 17
        });

        var marker = new google.maps.Marker({
            position: location,
            map: map
        });

        var infoWindow = new google.maps.InfoWindow({
            content: '<div id="content"><%= image_tag @listing.images.first.image, size: "400x200" %></div>'
        });

        infoWindow.open(map, marker);
    }

    google.maps.event.addDomListener(window,'load', initialize);
</script>
<% if @listing.images.present? %>
    <div style='background-image: url(<%= url_for(@listing.images.first.image) %>);
        height: 600px;
        background-attachment: fixed;
        background-position: center;
        background-repeat: no-repeat;
        background-size: cover;'> 
    </div>
<% else %>
    <div> 
        <h1 class="text-danger d-xl-flex justify-content-xl-center" style="margin-top: 250px;margin-bottom: 150px;"> No Image uploaded! </h1>
    </div>
<% end %>
<div class="container">
    <div class="row" style="margin-top: 55px;">
        <div class="col-xl-8">
            <p><span style="font-size: 42px;color: #16f063;"><%= @listing.listing_name %></span> <br/>Â Hosted by <%= @host_details.first_name %> <%= @host_details.last_name %></p>
        </div>
        <div class="col-xl-4">
            <div class="row" style="margin-top: 22px;">
                <div class="col">
                    <% if @listing.user_id == current_user.id %>
                            <%= link_to raw("<i class='fa fa-pen'></i> Edit"), room_listing_path(@listing), class: "btn btn-outline-info roundedButton", style: "margin-right: 15px; margin-left: 50px"  %>
                            <%= link_to raw("<i class='fa fa-trash'></i> Delete"), listing_url(@listing), class: "btn btn-outline-danger roundedButton", method: :delete, data: { confirm: "You sure?" },  style:"margin-left: 15px " %>
                    <%end%>
                    <h4 style="margin-bottom: 15px;"><%= pluralize(@listing_reviews.count, "Review", ) %>: <span id="review-average" data-score="<%= @review_average %>"></span> </h4>
                    <script>
                        $('#review-average').raty({
                            readOnly: true,
                            score: function() {
                                if $(this).attr('data-score') != 0{
                                    return $(this).attr('data-score');
                                }else{
                                    return 0
                                }
                            },
                            path: '/assets/'
                        });
                    </script>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <div>
                <hr />
                <ul class="nav nav-pills d-xl-flex justify-content-xl-center">
                    <li class="nav-item pill-1"><a role="tab" data-toggle="pill" class="nav-link active" href="#tab-1">Details</a></li>
                    <li class="nav-item pill-1"><a role="tab" data-toggle="pill" class="nav-link " href="#tab-2">Host Information</a></li>
                    <li class="nav-item pill-1"><a role="tab" data-toggle="pill" class="nav-link " href="#tab-3">Gallery</a></li>
                    <li class="nav-item pill-1"><a role="tab" data-toggle="pill" class="nav-link " href="#tab-4">Reviews</a></li>
                </ul>
                <div class="tab-content">
                     <%= render 'details' %>
                    <div role="tabpanel" class="tab-pane fade" id="tab-2">
                        <%= render 'host_information' %>
                    </div>
                    <div role="tabpanel" class="tab-pane fade" id="tab-3">
                        <%= render 'gallery'%>
                    </div>
                    <div role="tabpanel" class="tab-pane fade" id="tab-4">
                        <%= render 'reviews'%>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>